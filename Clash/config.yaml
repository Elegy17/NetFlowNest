mixed-port: 7890
redir-port: 7891
tproxy-port: 1536
allow-lan: true
mode: Rule
geodata-mode: true
geodata-loader: standard
unified-delay: true
log-level: silent
ipv6: true
external-controller: 0.0.0.0:9999

external-ui: ./UI/Yacd
secret: ""

tcp-concurrent: true
enable-process: true
find-process-mode: strict
global-client-fingerprint: chrome



geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat"
  geosite: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat"
  mmdb: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/country.mmdb"

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "Mijia Cloud"

tun:
  enable: false
  device: tun0
  stack: system
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-detect-interface: true
  
dns:
  enable: true
  prefer-h3: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.0/15
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "connect.rom.miui.com"
    - "localhost.ptlogin2.qq.com"
  default-nameserver:
    - 223.5.5.5
    - 8.8.8.8
  nameserver:
    - "https://doh.pub/dns-query"
    - "https://dns.alidns.com/dns-query"
    
    

######### é”šç‚¹ start #######
proxies:
# ç­–ç•¥ç»„ç›¸å…³
pr: &pr
  type: select  #æ‰‹åŠ¨é€‰æ‹©èŠ‚ç‚¹   #url-test è‡ªåŠ¨é€‰æ‹©èŠ‚ç‚¹
  proxies: 
  - ğŸ¯ æ€»æ¨¡å¼
  - ğŸŒ å…¨çƒç›´è¿
  - ğŸª© å¢ƒå¤–æµé‡
  - ğŸ”® è‡ªåŠ¨é€‰æ‹©
  - ğŸš« æ‹’ç»å‡ºç«™
  - ğŸ‡­ğŸ‡° é¦™æ¸¯
  - ğŸ‡¯ğŸ‡µ æ—¥æœ¬
  - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
  - ğŸ‡ºğŸ‡² ç¾å›½
  - ğŸ§© å…¶å®ƒåœ°åŒº

#ç­–ç•¥ç»„èŠ‚ç‚¹ç›¸å…³ï¼ˆæ‰‹åŠ¨ï¼‰
u: &u
  type: select
  use:
  - è®¢é˜…åœ°å€å
  
#ç­–ç•¥ç»„èŠ‚ç‚¹ç›¸å…³ï¼ˆè‡ªåŠ¨ï¼‰
ul: &ul
  type: url-test
  url: http://www.gstatic.com/generate_204
  interval: 300
  tolerance: 2
  use:
  - è®¢é˜…åœ°å€å

#ç­–ç•¥ç»„èŠ‚ç‚¹ç›¸å…³ï¼ˆè‡ªåŠ¨ï¼‰
ur: &ur
  type: url-test    #å¿…é¡»ï¼Œç­–ç•¥ç»„çš„ç±»å‹
  url: http://www.gstatic.com/generate_204  #å¥åº·æ£€æŸ¥æµ‹è¯•åœ°å€
  interval: 300   #å¥åº·æ£€æµ‹é—´éš”ï¼Œå¦‚ä¸ä¸º 0 åˆ™å¯ç”¨å®šæ—¶æµ‹è¯•ï¼Œå•ä½ä¸ºç§’
  tolerance: 2

#ç­–ç•¥ç»„èŠ‚ç‚¹ç›¸å…³ï¼ˆæ‰‹åŠ¨ï¼‰
ury: &ury
  type: select    #å¿…é¡»ï¼Œç­–ç•¥ç»„çš„ç±»å‹
  
#ä»£ç†é›†è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³
p: &p
  type: http  #å¯é€‰http/file
  interval: 3600  #èŠ‚ç‚¹æ›´æ–°æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  # filter: "(?i)æ¸¯|hk|hongkong|hong kong"  #å…³é”®å­—ç­›é€‰èŠ‚ç‚¹,æ¯”å¦‚ç­›é€‰å‡ºUSAçš„èŠ‚ç‚¹
  # exclude-filter: "xxx"   #è§„åˆ™è¡¨è¾¾å¼æ’é™¤
  # exclude-type: "ss|http"    #å…³é”®å­—æ’é™¤ ç”¨ | åˆ†éš”
  health-check:  #å¥åº·æ£€æµ‹
    enable: true  #æ˜¯å¦å¯ç”¨æ£€æµ‹
      # lazy: false  #æ‡’æƒ°çŠ¶æ€ï¼Œé»˜è®¤ä¸ºtrue,ä¸ä½¿ç”¨è¯¥é›†åˆèŠ‚ç‚¹æ—¶ï¼Œä¸è¿›è¡Œæµ‹è¯•
    url: https://www.gstatic.com/generate_204  #æ£€æµ‹åœ°å€ å¯é€‰ï¼šhttps://cp.cloudflare.com
    interval: 300  #æ£€æµ‹é—´éš”ï¼ˆæ¯«ç§’ï¼‰
      # timeout: 3600  #å¥åº·æ£€æµ‹è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      # expected-status: 200/302  #æœŸæœ›çŠ¶æ€ å¯ï¼š200/302åŒ¹é… 200 å’Œ 302 çŠ¶æ€ç  400-503åŒ¹é… 400 åˆ° 503 çŠ¶æ€ç  200/302/400-503åŒ¹é… 200 å’Œ 302 ä»¥åŠ 400 åˆ° 503 çŠ¶æ€ç 
######### é”šç‚¹ end #######
    
#ä»£ç†é›†ï¼ˆproxy-providersï¼‰
proxy-providers:
  è®¢é˜…åœ°å€å:
    <<: *p
    path: "æœºåœºè®¢é˜…é“¾æ¥"

#ç­–ç•¥ç»„ï¼ˆproxy-groupsï¼‰
proxy-groups:
#æ¨¡å¼ç­–ç•¥åˆ†ç±»
  - name: ğŸ¯ æ€»æ¨¡å¼
    type: select  #æ‰‹åŠ¨é€‰æ‹©èŠ‚ç‚¹   #url-test è‡ªåŠ¨é€‰æ‹©èŠ‚ç‚¹
    proxies: 
    - ğŸŒ å…¨çƒç›´è¿
    - ğŸª© å¢ƒå¤–æµé‡
    - ğŸ”® è‡ªåŠ¨é€‰æ‹©
    - ğŸš« æ‹’ç»å‡ºç«™
    - ğŸ‡­ğŸ‡° é¦™æ¸¯
    - ğŸ‡¯ğŸ‡µ æ—¥æœ¬
    - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
    - ğŸ‡ºğŸ‡² ç¾å›½
    - ğŸ§© å…¶å®ƒåœ°åŒº
    
  - name: ğŸª© å¢ƒå¤–æµé‡
    <<: *u
    
  - name: ğŸ”® è‡ªåŠ¨é€‰æ‹©
    <<: *ul
    
#æœåŠ¡ç­–ç•¥åˆ†ç±»
  - name: ğŸ“¨ FCMæ¨é€æœåŠ¡
    <<: *pr

  - name: ğŸ“£ GoogleæœåŠ¡
    <<: *pr

  - name: ğŸ¬ YouTube
    <<: *pr
    
  - name: ğŸ§¸ Twitter
    <<: *pr
      
  - name: ğŸ¥ Netflix
    <<: *pr
    
  - name: ğŸ“– Facebook
    <<: *pr
    
  - name: ğŸ“± Telegram
    <<: *pr
    
  - name: âš™ï¸ GitHub
    <<: *pr
    
  - name: ğŸ§ Spotify
    <<: *pr
    
  - name: ğŸª Messenger
    <<: *ur
    use:
    - è®¢é˜…åœ°å€å
    filter: "(?i)æ–°|æ—¥|ç¾"
    
  - name: ğŸ¤– OpenAI
    <<: *ur
    use:
    - è®¢é˜…åœ°å€å
    filter: "(?i)æ–°|æ—¥|ç¾"
    
#æœºåœºåˆ†ç±»
  - name: æœºåœºåéšä¾¿èµ·
    <<: *ur
    use:
    - è®¢é˜…åœ°å€å

#åœ°åŒºç­–ç•¥åˆ†ç±»
  - name: ğŸ‡­ğŸ‡° é¦™æ¸¯
    <<: *u
    filter: "(?i)æ¸¯|hk|hongkong|hong kong"
    exclude-filter: "ç¾|æ—¥"  #å±è”½
  
  - name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬
    <<: *u
    filter: "(?i)æ—¥æœ¬|jp|japan|Tokyo"

  - name: ğŸ‡ºğŸ‡² ç¾å›½
    <<: *u
    filter: "(?i)ç¾|us|unitedstates|united states"

  - name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
    <<: *u
    filter: "(?i)^(?!.*(?:us)).*(æ–°|sg|singapore)"

  - name: ğŸ§© å…¶å®ƒåœ°åŒº
    <<: *u
    filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"

#å‡ºç«™ç­–ç•¥åˆ†ç±»
  - name: ğŸŒ å…¨çƒç›´è¿
    type: select
    proxies:
      - DIRECT
  
  - name: ğŸš« æ‹’ç»å‡ºç«™
    type: select
    proxies:
      - REJECT

  - name: ğŸ‹ æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
    - ğŸ¯ æ€»æ¨¡å¼
    - ğŸŒ å…¨çƒç›´è¿
    - ğŸš« æ‹’ç»å‡ºç«™

  # - name: ğŸ›‘ å¹¿å‘Šæ‹¦æˆª
    # type: select
    # proxies:
    # - ğŸš« æ‹’ç»å‡ºç«™
    # - ğŸ¯ æ€»æ¨¡å¼
    
    
#è§„åˆ™é›†é¢„è®¾
rule-anchor:
  ip: &ip
    type: http
    interval: 86400
    proxy: ""
    behavior: ipcidr
    format: yaml
    
  domain: &domain
    type: http
    interval: 86400
    proxy: ""
    behavior: domain
    format: yaml
    
  classical: &classical
    type: http
    interval: 86400
    proxy: ""
    behavior: classical
    format: yaml
#è§„åˆ™é›†ï¼ˆrule-providersï¼‰
rule-providers:
#classicalåˆ†ç±»
  FCM:
    <<: *classical
    path: ./rule/FCM.yaml
    url: "https://raw.githubusercontent.com/Elegy17/NetFlowNest/main/Clash/FCM.yaml"

  Google:
    <<: *classical
    path: ./rule/Google.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml"

  YouTube:
    <<: *classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
    path: ./rule/YouTube.yaml
    
  GitHub:
    <<: *classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.yaml"
    path: ./rule/GitHub.yaml
    
  Spotify:
    <<: *classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.yaml"
    path: ./rule/Spotify.yaml
  
  OpenAI:
    <<: *classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
    path: ./rule/OpenAI.yaml
    
  åˆ†æµä¿®æ­£:
    <<: *classical
    url: "https://raw.githubusercontent.com/Elegy17/NetFlowNest/main/Clash/Shunt-Correction.yaml"
    path: ./rule/åˆ†æµä¿®æ­£.yaml
  
  è§„åˆ™ä¿®æ­£:
    <<: *classical
    url: "https://raw.githubusercontent.com/Elegy17/NetFlowNest/main/Clash/Rule-Amendments.yaml"
    path: ./rule/è§„åˆ™ä¿®æ­£.yaml
    
#IPåˆ†ç±»
  telegram_ip:
    <<: *ip
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt"
    path: ./rule/telegram_ip.yaml


#è§„åˆ™ï¼ˆrulesï¼‰
rules:
    #åŠ«æŒç±»
  - AND,((NETWORK,UDP),(DST-PORT,123)),ğŸŒ å…¨çƒç›´è¿
  - AND,((PROCESS-NAME,mihomo),(NOT,((IN-TYPE,inner)))),REJECT
  - AND,((PROCESS-NAME,clash),(NOT,((IN-TYPE,inner)))),REJECT

    #åº”ç”¨ç±»
  - PROCESS-NAME,com.facebook.orca,ğŸª Messenger  #Messenger
  - PROCESS-NAME,com.google.android.googlequicksearchbox,ğŸ‡ºğŸ‡² ç¾å›½
  
    #åŸŸåç±»
   
    #è§„åˆ™ç±»
  - RULE-SET,åˆ†æµä¿®æ­£,ğŸª© å¢ƒå¤–æµé‡
  - RULE-SET,è§„åˆ™ä¿®æ­£,ğŸŒ å…¨çƒç›´è¿
  - RULE-SET,FCM,ğŸ“¨ FCMæ¨é€æœåŠ¡
  - RULE-SET,telegram_ip,ğŸª© å¢ƒå¤–æµé‡
  - RULE-SET,YouTube,ğŸ¬ YouTube
  - RULE-SET,GitHub,âš™ï¸ GitHub
  - RULE-SET,Spotify,ğŸ§ Spotify
  - RULE-SET,OpenAI,ğŸ¤– OpenAI
  - RULE-SET,Google,ğŸ“£ GoogleæœåŠ¡
  
    #GEOSITEç±»
    # - GEOSITE,category-ads-all,ğŸ›‘ å¹¿å‘Šæ‹¦æˆª
  - GEOSITE,CN,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,apple-cn,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,google-cn,ğŸŒ å…¨çƒç›´è¿
  - GEOSITE,youtube,ğŸ¬ YouTube
  
    #GEOIPç±»
  - GEOIP,private,ğŸŒ å…¨çƒç›´è¿,no-resolve
  - GEOIP,CN,ğŸŒ å…¨çƒç›´è¿,no-resolve
    #- GEOSITE,openai,ğŸ¤– OpenAI
  - GEOIP,cloudflare,ğŸª© å¢ƒå¤–æµé‡
  - GEOIP,cloudfront,ğŸª© å¢ƒå¤–æµé‡
  - GEOIP,facebook,ğŸ“– Facebook
  - GEOIP,fastly,ğŸª© å¢ƒå¤–æµé‡
    # - GEOIP,google,ğŸ“£ GoogleæœåŠ¡
  - GEOIP,netflix,ğŸ¥ Netflix
  - GEOIP,telegram,ğŸ“± Telegram
  - GEOIP,twitter,ğŸ§¸ Twitter
  
    #é€šç”¨ç±»
  - MATCH,ğŸ‹ æ¼ç½‘ä¹‹é±¼
